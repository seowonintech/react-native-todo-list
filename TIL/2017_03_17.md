# 2017.03.17.금

# 중요!!

**Reducer에서 값 반환할 때 반드시 state을 복사한다음 덮어씌우는 식으로 return 하시오!**
안그러면 다른 값 날아감

```javascript
const mainState = (state = initState, action) => {
    switch (action.type) {
        case ActionTypes.INIT_TODO:
            return {
                ...state, // state 복사 안해주면 다른 항목들이 날아간다. 
                textInputValue: ''
            };
```

## 배운 점

### React Native 예제들이 setState를 사용할 때 redux에 적용하려면?
* setState을 store의 state이라고 생각하고 구현하면 됨. 아래 예제 참고
```javascript
<TextInput
    style={{width: 300, height: 40, borderColor: 'gray', borderWidth: 1}}
    onChangeText={text => handleChangeText(text)} // 1. onChangeText 이벤트로 발생한 text를 handleChangeText(text)로 넘겨주고
    value={textInputValue} // 1) 항상 textInputValue을 바라보고 있는데
/>

const mapStateToProps = (state) => ({
    textInputValue: state.mainState.textInput // textInputValue은 store의 mainState리듀서에 들어있는 textInput이다.
});

const dispatchToProps = (dispatch, ownProps) => ({
    onClickAddButton: (text) => {
        dispatch(addTodo(text));
        dispatch(initTodo());
    },
    handleChangeText: (text) => {
        dispatch(modifyTodo(text)); // 2. 1. 에서 받은 text를 modifyTodo(text)에 넣어서 dispatch()시켜준다.
    }
});

AddTodo = connect(mapStateToProps, dispatchToProps)(AddTodo);
```

### Redux 패턴 : 배열안의 오브젝트 수정 할 때 성능향상법

[Redux Patterns: Add/Edit/Remove Objects in an Array](https://medium.com/@justintulk/redux-patterns-add-edit-remove-objects-in-an-array-6ee70cab2456#.1fqc57hoq)

## 이슈

### 기존에 저장된 데이터는 modify되는데 새로 add 한 정보는 modify 되지않고 액션이 여러 항목에서 동시에 일어난다.

* initId가 잘못되었다.

샘플데이터
```javascript
let sampleTodos = [
    {
        id: 0,
        text: "eat"
    },
    {
        id: 1,
        text: "play"
    },
    {
        id: 2,
        text: "love"
    },
];
```

```javascript
let initId = 3; // 샘플데이터 id가 2로 끝나므로 initId가 3이여야 새로 add되는 항목에 3이 들어가고 ++ 연산되어 다음 항목에 id값으로 4를 넣을 준비를 하게 된다.

export const addTodo = (text) => ({
    type: ActionTypes.ADD_TODO,
    id: initId++, // initId 가 id: 값으로 적용 되고 ++ 연산된다 주의하자!
    text
});
```